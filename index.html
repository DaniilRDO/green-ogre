<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>SECURE TERMINAL</title>

<style>
body {
    background: black;
    color: #00ff66;
    font-family: monospace;
    padding: 20px;
}

.hidden { display: none; }

#terminal {
    white-space: pre-wrap;
    min-height: 200px;
    margin-bottom: 20px;
}

input, button {
    background: black;
    color: #00ff66;
    border: 1px solid #00ff66;
    font-family: monospace;
    padding: 6px;
}
    
#timer {
    font-size: 26px;
    margin-bottom: 15px;
}

.panic {
    background: #200;
    color: red;
    animation: blink 1s infinite;
}

.fake-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 25px;
}

.fake-box label {
    display: block;
    margin-bottom: 6px;
    text-align: center;
    opacity: 0.7;
}

.quiz-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.light {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #300;
}
.light.green { background: #00ff66; }
.light.red { background: red; }

.screamer {
    position: fixed;
    inset: 0;
    background: black;
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
}
.screamer img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}
</style>
</head>

<body>

<div id="timer">10:00</div>
<div id="terminal"></div>

<input id="input" placeholder="ENTER CODE">

<div id="fakeFields" class="hidden"></div>
<div id="quiz" class="hidden"></div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="scream1" src="test.mp3"></audio>
<audio id="screamEnd" src="endtimes.mp3"></audio>

<script>
let stage = 1;
let timeLeft = 600;
let timerInterval;

const terminal = document.getElementById("terminal");
const input = document.getElementById("input");
const timerDisplay = document.getElementById("timer");
const beep = document.getElementById("beep");

// Функція друку тексту
function typeText(text, cb) {
    let i = 0;
    terminal.innerHTML = "";
    const interval = setInterval(() => {
        terminal.innerHTML += text[i++];
        if (i >= text.length) {
            clearInterval(interval);
            if (cb) cb();
        }
    }, 18);
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 60) document.body.classList.add("panic");
        if (timeLeft <= 0) endGame();

        const m = String(Math.floor(timeLeft/60)).padStart(2,"0");
        const s = String(timeLeft%60).padStart(2,"0");
        timerDisplay.textContent = `${m}:${s}`;
    }, 1000);
}

function screamer(audioId, imgName) {
    const div = document.createElement("div");
    div.className = "screamer";
    div.innerHTML = `<img src="${imgName}.jpg">`;
    document.body.appendChild(div);
    const audio = document.getElementById(audioId);
    if(audio) audio.play();
    setTimeout(()=>div.remove(), 1500);
}

function endGame() {
    clearInterval(timerInterval);
    screamer("screamEnd", "endtimes");
}

// Головний ввід
input.addEventListener("keydown", e => {
    if (beep) beep.cloneNode(true).play(); // cloneNode дозволяє грати звуки часто
    if (e.key !== "Enter") return;
    const code = input.value.toUpperCase();
    input.value = "";

    if (code === "TEST") screamer("scream1", "test");
    if (code === "TIME+") timeLeft += 300;
    if (code === "ENDGAME") timeLeft = 1;

    advance(code);
});

function advance(code) {
    if (stage === 1 && code === "НЕТУРУЧЕКНЕТКОНФЕТОК") {
        stage = 2;
        input.classList.add("hidden");
        stage2();
    }
    else if (stage === 3 && code === "CODE3") {
        stage = 4;
        startCode4();
    }
}

/* ===== ЕТАП 2 ===== */
function stage2() {
    const stage2Text = `
Перший контакт із аномалією показав:
стандартні методи не працюють.
Агент, який покладається лише на руки, — приречений.

ВАШЕ ЗАВДАННЯ: відкрити цей конверт БЕЗ використання рук.
Дозволено: рот, лікоть, коліно, сила тяжіння.
Заборонено: здоровий глузд.
`;
    typeText(stage2Text, createFields);
}

/* ===== ПОЛЯ ===== */
function createFields() {
    // Використовуємо термінал як контейнер, або створіть <div id="container"> в HTML
    const container = document.getElementById("terminal"); 
    const fields = document.createElement("div");
    fields.style.marginTop = "20px";

    const labels = ["ПОЛЕ1", "ПОЛЕ2", "ПОЛЕ3", "ПОЛЕ4", "ПОЛЕ5"];
    const correctIndex = 2; // Тобто ПОЛЕ3

    labels.forEach((label, i) => {
        const box = document.createElement("div");
        box.style.marginBottom = "10px";

        const l = document.createElement("span");
        l.innerText = label + ": ";

        const fieldInput = document.createElement("input");
        fieldInput.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                if (fieldInput.value.toUpperCase() === "MI BOOOMBOO" && i === correctIndex) {
                    stage = 3;
                    fields.remove();
                    terminal.innerHTML = "ДОСТУП ДОЗВОЛЕНО. ПЕРЕХІД ДО ЕТАПУ 3...";
                    setTimeout(stage3, 2000);
                } else {
                    timeLeft -= 60;
                    fieldInput.value = "";
                    terminal.innerHTML += "\n<span style='color:red'>ERROR: WRONG SEQUENCE</span>";
                }
            }
        });

        box.appendChild(l);
        box.appendChild(fieldInput);
        fields.appendChild(box);
    });

    container.appendChild(fields);
}

function stage3() {
    terminal.innerHTML = "Етап 3 активовано. Введіть CODE3 для продовження.";
    input.classList.remove("hidden"); // Повертаємо головне поле вводу
}

// Запуск першої сцени
typeText(`АГЕНТЕ, система дала збій... Шукайте код у Конверті №1.`, startTimer);

function stage4() {
    const quiz = document.getElementById("quiz");
    quiz.classList.remove("hidden");
    quiz.innerHTML="";

    const q = [
        ["Повна назва ДДМА","ДОНБАСЬКА ДЕРЖАВНА МАШИНОБУДІВНА АКАДЕМІЯ"],
        ["Те, що неможливо продати","СЛОН"],
        ["Шкода гачка","150"],
        ["Відеокарта","GTX 4060"],
        ["Що в кармані","НІЧОГО"],
        ["Традиційний подарунок","АНТИСТРЕС"],
        ["Код","CODE4"]
    ];

    q.forEach(([t,a])=>{
        const d=document.createElement("div");
        d.className="quiz-item";
        const i=document.createElement("input");
        i.placeholder=t;
        const l=document.createElement("div");
        l.className="light";
        i.onkeydown=e=>{
            if(e.key!=="Enter")return;
            if(i.value.toUpperCase()===a){
                l.className="light green";
                i.disabled=true;
                checkQuiz();
            } else l.className="light red";
        };
        d.append(i,l);
        quiz.appendChild(d);
    });
}

function checkQuiz(){
    if([...document.querySelectorAll(".light")]
        .every(l=>l.classList.contains("green"))){
        startCode5();
    }
}

function startCode5(){
    timerDisplay.style.display="none";
    document.body.innerHTML="<pre style='color:red'>SYSTEM FAILURE\nPRESS F</pre>";
    document.addEventListener("keydown",e=>{
        if(e.key.toUpperCase()==="F") location.reload();
    });
}

typeText(
`АГЕНТЕ [ІМʼЯ],

якщо ви читаєте це повідомлення — значить система дала збій.
Або ми. Або ви.

Аналітичний Відділ фіксує аномальну активність, повʼязану з кодовою назвою GREEN OGRE.

Спочатку це виглядало як жарт.
Потім — як серія безглуздих артефактів.
А тепер — як загроза, природу якої ми не до кінця розуміємо.

У матеріалах фігурують:
– огр зеленого кольору
– тварини, які не повинні бути тут
– предмети, що не мають сенсу
– і ви

Ми не знаємо, чому саме ви були обрані.
Але всі попередні кандидати не витримали абсурду.

Для отримання доступу до Обʼєкта Ω вам необхідно пройти 6 етапів перевірки.

Шукай приховане серед того що бачиш, не довіряй друзям, власним очам, лише своєму павучому відчуттю.
Десь серед УСЬОГО тексту, який буде зустрчатися тобі будуть скриті посилання, частинки пазлів і гумору.

Ми довіряємо цю місію тобі, лише тобі. Ніхто інший не зможе впоратися з цим завданням. Цей текст немає жодного значення, просто
треба щоб він виглядав круто й загадково. Єдинне що дійсно важливе, і сподіваюсь ти це не пропустиш, це час. Він спливає, так швидко, 
що навіть твій друг не може зробити щось корисне бо постійно з тобою грає. Так от, агенту, якщо він закінчиться, ти ніколи не дійдеш до фінального
етапу, і це означає що ти повільний лохобан, тому Сося передає привіт, і можеш починати.

Не шукайте логіку.
Почніть з Конверта №1.
`,
startTimer
);
</script>

</body>
</html>
